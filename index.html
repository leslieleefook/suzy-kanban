<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suzy's Task Board ðŸŒ¸</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        header h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #ff6b9d, #c44569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }
        header p { color: #888; font-size: 0.9rem; }
        .board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .column {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            min-height: 400px;
        }
        .column-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        .column-header h2 { font-size: 1rem; font-weight: 600; }
        .count {
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        .todo .column-header { border-color: #ffd93d; }
        .doing .column-header { border-color: #6bcb77; }
        .done .column-header { border-color: #4d96ff; }
        .card {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #ff6b9d;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .card h3 { font-size: 0.95rem; margin-bottom: 6px; }
        .card p { font-size: 0.8rem; color: #aaa; margin-bottom: 8px; line-height: 1.4; }
        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: #666;
        }
        .priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.7rem;
        }
        .priority.critical { background: rgba(255,70,70,0.3); color: #ff4646; }
        .priority.high { background: rgba(255,107,107,0.2); color: #ff6b6b; }
        .priority.medium { background: rgba(255,217,61,0.2); color: #ffd93d; }
        .priority.low { background: rgba(153,153,153,0.2); color: #999; }
        .doing .card { border-color: #6bcb77; }
        .done .card { border-color: #4d96ff; opacity: 0.7; }
        .empty { color: #555; text-align: center; padding: 40px 20px; font-size: 0.9rem; }
        .refresh-note { text-align: center; margin-top: 20px; color: #555; font-size: 0.8rem; }
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            color: #888;
            font-size: 0.85rem;
        }
        .stats span { display: flex; align-items: center; gap: 5px; }
        .loading { text-align: center; padding: 50px; color: #888; }
        .error { text-align: center; padding: 50px; color: #ff6b6b; }
        @media (max-width: 768px) {
            .board { grid-template-columns: 1fr; }
            header h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>ðŸŒ¸ Suzy's Task Board</h1>
        <p>What I'm working on for Leslie â€¢ Synced from Infinity</p>
    </header>
    
    <div class="stats">
        <span>ðŸ“‹ Total: <strong id="total-count">-</strong></span>
        <span>ðŸ”„ Active: <strong id="active-count">-</strong></span>
        <span>âœ… Completed: <strong id="completed-count">-</strong></span>
    </div>
    
    <div class="board" id="board">
        <div class="loading">Loading tasks...</div>
    </div>
    
    <p class="refresh-note">Last updated: <span id="last-update">-</span></p>

    <script>
        async function loadTasks() {
            try {
                const response = await fetch('tasks.json?t=' + Date.now());
                if (!response.ok) throw new Error('Failed to load tasks');
                const data = await response.json();
                renderTasks(data);
            } catch (err) {
                document.getElementById('board').innerHTML = `<div class="error">Failed to load tasks: ${err.message}</div>`;
            }
        }

        function extractPriority(desc) {
            if (!desc) return 'medium';
            const lower = desc.toLowerCase();
            if (lower.includes('critical')) return 'critical';
            if (lower.includes('high')) return 'high';
            if (lower.includes('medium')) return 'medium';
            if (lower.includes('low')) return 'low';
            return 'medium';
        }

        function stripHtml(html) {
            if (!html) return '';
            return html.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
        }

        function renderTasks(data) {
            const boardEl = document.getElementById('board');
            
            const columns = {
                todo: { title: 'ðŸ“‹ To Do', color: '#ffd93d', tasks: [] },
                'in-progress': { title: 'ðŸ”„ In Progress', color: '#6bcb77', tasks: [] },
                completed: { title: 'âœ… Done', color: '#4d96ff', tasks: [] }
            };
            
            // Sort and categorize
            const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
            data.tasks.forEach(task => {
                task.priority = extractPriority(task.description);
                const status = task.status || 'todo';
                if (columns[status]) {
                    columns[status].tasks.push(task);
                }
            });
            
            // Sort each column by priority
            Object.values(columns).forEach(col => {
                col.tasks.sort((a, b) => (priorityOrder[a.priority] || 2) - (priorityOrder[b.priority] || 2));
            });
            
            let counts = { todo: columns.todo.tasks.length, doing: columns['in-progress'].tasks.length, done: columns.completed.tasks.length };
            
            boardEl.innerHTML = '';
            
            Object.entries(columns).forEach(([key, col]) => {
                const colDiv = document.createElement('div');
                colDiv.className = `column ${key === 'in-progress' ? 'doing' : key}`;
                
                let cardsHtml = col.tasks.map(task => `
                    <div class="card">
                        <h3>${task.name}</h3>
                        <p>${stripHtml(task.description) || 'No description'}</p>
                        <div class="card-meta">
                            <span></span>
                            <span class="priority ${task.priority}">${task.priority}</span>
                        </div>
                    </div>
                `).join('');
                
                if (col.tasks.length === 0) {
                    cardsHtml = '<p class="empty">Nothing here</p>';
                }
                
                colDiv.innerHTML = `
                    <div class="column-header">
                        <h2>${col.title}</h2>
                        <span class="count">${col.tasks.length}</span>
                    </div>
                    ${cardsHtml}
                `;
                
                boardEl.appendChild(colDiv);
            });
            
            document.getElementById('total-count').textContent = data.tasks.length;
            document.getElementById('active-count').textContent = counts.todo + counts.doing;
            document.getElementById('completed-count').textContent = counts.done;
            document.getElementById('last-update').textContent = data.updatedAt || new Date().toLocaleString();
        }
        
        loadTasks();
    </script>
</body>
</html>
